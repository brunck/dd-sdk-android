/*
 * Unless explicitly stated otherwise all files in this repository are licensed under the Apache License Version 2.0.
 * This product includes software developed at Datadog (https://www.datadoghq.com/).
 * Copyright 2016-Present Datadog, Inc.
 */

package com.datadog.android.sessionreplay.internal.net

import com.datadog.android.utils.forge.Configurator
import fr.xgouchet.elmyr.Forge
import fr.xgouchet.elmyr.junit5.ForgeConfiguration
import fr.xgouchet.elmyr.junit5.ForgeExtension
import org.assertj.core.api.Assertions.assertThat
import org.junit.jupiter.api.BeforeEach
import org.junit.jupiter.api.RepeatedTest
import org.junit.jupiter.api.Test
import org.junit.jupiter.api.extension.ExtendWith
import org.junit.jupiter.api.extension.Extensions
import org.mockito.junit.jupiter.MockitoExtension
import org.mockito.junit.jupiter.MockitoSettings
import org.mockito.quality.Strictness
import java.nio.charset.Charset
import java.util.zip.Deflater
import java.util.zip.Inflater
import kotlin.experimental.and

@Extensions(
        ExtendWith(MockitoExtension::class),
        ExtendWith(ForgeExtension::class)
)
@MockitoSettings(strictness = Strictness.LENIENT)
@ForgeConfiguration(Configurator::class)
internal class BytesCompressorTest {

    private val text1 = "{\"application_id\":\"f80e917c-3cd0-4048-ade7-1c4c207baa99\",\"session_id\":\"c3c2cfdf-2bf3-4a30-8368-767bc9310fb8\",\"view_id\":\"0189f34d-b200-48bb-b105-39d27285393d\",\"records\":[{\"timestamp\":1663834330974,\"type\":11,\"data\":{\"source\":2,\"positions\":[{\"id\":0,\"x\":181,\"y\":577,\"timestamp\":1663834330707},{\"id\":0,\"x\":181,\"y\":577,\"timestamp\":1663834330971}]}}]}\u0000\u0001\u0000\u0000\u0000\u0002{}\u0000\u0000\u0000\u0000\u0000�{\"application_id\":\"f80e917c-3cd0-4048-ade7-1c4c207baa99\",\"session_id\":\"c3c2cfdf-2bf3-4a30-8368-767bc9310fb8\",\"view_id\":\"0189f34d-b200-48bb-b105-39d27285393d\",\"records\":[{\"timestamp\":1663834331991,\"type\":7}]}\u0000\u0001\u0000\u0000\u0000\u0002{}\u0000\u0000\u0000\u0000\u0006�{\"application_id\":\"f80e917c-3cd0-4048-ade7-1c4c207baa99\",\"session_id\":\"c3c2cfdf-2bf3-4a30-8368-767bc9310fb8\",\"view_id\":\"5ff4f0b2-0023-45b7-8307-11f09ce10fc6\",\"records\":[{\"timestamp\":1663834331991,\"type\":4,\"data\":{\"width\":392,\"height\":829}},{\"timestamp\":1663834331991,\"type\":6,\"data\":{\"has_focus\":true}},{\"timestamp\":1663834331991,\"type\":10,\"data\":{\"wireframes\":[{\"id\":265380693,\"x\":0,\"y\":0,\"width\":392,\"height\":829,\"shapeStyle\":{\"backgroundColor\":\"#FFFFFFFF\",\"opacity\":255},\"type\":\"shape\"},{\"id\":246406668,\"x\":0,\"y\":0,\"width\":392,\"height\":781,\"type\":\"shape\"},{\"id\":143773022,\"x\":0,\"y\":30,\"width\":392,\"height\":750,\"type\":\"shape\"},{\"id\":3044468,\"x\":0,\"y\":86,\"width\":392,\"height\":694,\"type\":\"shape\"},{\"id\":222818884,\"x\":0,\"y\":86,\"width\":392,\"height\":32,\"shapeStyle\":{\"backgroundColor\":\"#A538AFFF\",\"opacity\":255},\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":12,\"color\":\"#FFFFFFFF\"},\"textPosition\":{\"padding\":{\"top\":8,\"bottom\":8,\"left\":0,\"right\":0},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":57621958,\"x\":0,\"y\":118,\"width\":392,\"height\":662,\"type\":\"shape\"},{\"id\":139710855,\"x\":304,\"y\":693,\"width\":56,\"height\":56,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"shape\"},{\"id\":263601373,\"x\":0,\"y\":757,\"width\":392,\"height\":23,\"shapeStyle\":{\"backgroundColor\":\"#632CA6BF\",\"opacity\":191},\"type\":\"text\",\"text\":\"xxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#FFFFFFFF\"},\"textPosition\":{\"padding\":{\"top\":2,\"bottom\":2,\"left\":2,\"right\":2},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"top\"}}},{\"id\":133719008,\"x\":0,\"y\":30,\"width\":392,\"height\":56,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"shape\"}]}}]}"
    private val text2 = "{\"application_id\":\"f80e917c-3cd0-4048-ade7-1c4c207baa99\",\"session_id\":\"c3c2cfdf-2bf3-4a30-8368-767bc9310fb8\",\"view_id\":\"5ff4f0b2-0023-45b7-8307-11f09ce10fc6\",\"records\":[{\"timestamp\":1663834336346,\"type\":11,\"data\":{\"source\":2,\"positions\":[{\"id\":0,\"x\":147,\"y\":590,\"timestamp\":1663834335248},{\"id\":0,\"x\":147,\"y\":586,\"timestamp\":1663834335485},{\"id\":0,\"x\":147,\"y\":574,\"timestamp\":1663834335519},{\"id\":0,\"x\":147,\"y\":568,\"timestamp\":1663834335542},{\"id\":0,\"x\":147,\"y\":560,\"timestamp\":1663834335574},{\"id\":0,\"x\":147,\"y\":556,\"timestamp\":1663834335608},{\"id\":0,\"x\":147,\"y\":550,\"timestamp\":1663834336108},{\"id\":0,\"x\":147,\"y\":529,\"timestamp\":1663834336140},{\"id\":0,\"x\":147,\"y\":506,\"timestamp\":1663834336164},{\"id\":0,\"x\":147,\"y\":449,\"timestamp\":1663834336191},{\"id\":0,\"x\":150,\"y\":398,\"timestamp\":1663834336231},{\"id\":0,\"x\":160,\"y\":361,\"timestamp\":1663834336256},{\"id\":0,\"x\":165,\"y\":341,\"timestamp\":1663834336291},{\"id\":0,\"x\":169,\"y\":330,\"timestamp\":1663834336324},{\"id\":0,\"x\":169,\"y\":329,\"timestamp\":1663834336345}]}}]}\u0000\u0001\u0000\u0000\u0000\u0002{}\u0000\u0000\u0000\u0000\u0016\b{\"application_id\":\"f80e917c-3cd0-4048-ade7-1c4c207baa99\",\"session_id\":\"c3c2cfdf-2bf3-4a30-8368-767bc9310fb8\",\"view_id\":\"5ff4f0b2-0023-45b7-8307-11f09ce10fc6\",\"records\":[{\"timestamp\":1663834336595,\"type\":10,\"data\":{\"wireframes\":[{\"id\":265380693,\"x\":0,\"y\":0,\"width\":392,\"height\":829,\"shapeStyle\":{\"backgroundColor\":\"#FFFFFFFF\",\"opacity\":255},\"type\":\"shape\"},{\"id\":246406668,\"x\":0,\"y\":0,\"width\":392,\"height\":781,\"type\":\"shape\"},{\"id\":143773022,\"x\":0,\"y\":30,\"width\":392,\"height\":750,\"type\":\"shape\"},{\"id\":3044468,\"x\":0,\"y\":86,\"width\":392,\"height\":694,\"type\":\"shape\"},{\"id\":57621958,\"x\":0,\"y\":118,\"width\":392,\"height\":662,\"type\":\"shape\"},{\"id\":224257807,\"x\":0,\"y\":4,\"width\":392,\"height\":116,\"type\":\"shape\"},{\"id\":110768105,\"x\":0,\"y\":4,\"width\":192,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":24482926,\"x\":0,\"y\":24,\"width\":124,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":194766123,\"x\":0,\"y\":120,\"width\":392,\"height\":116,\"type\":\"shape\"},{\"id\":31252901,\"x\":0,\"y\":120,\"width\":192,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":40536442,\"x\":0,\"y\":140,\"width\":124,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":191998215,\"x\":0,\"y\":236,\"width\":392,\"height\":116,\"type\":\"shape\"},{\"id\":165606177,\"x\":0,\"y\":236,\"width\":192,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":243778374,\"x\":0,\"y\":256,\"width\":124,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":66440867,\"x\":0,\"y\":352,\"width\":392,\"height\":116,\"type\":\"shape\"},{\"id\":160866397,\"x\":0,\"y\":352,\"width\":192,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":250400210,\"x\":0,\"y\":372,\"width\":124,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":218935807,\"x\":0,\"y\":468,\"width\":392,\"height\":116,\"type\":\"shape\"},{\"id\":186770777,\"x\":0,\"y\":468,\"width\":192,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":220591390,\"x\":0,\"y\":488,\"width\":124,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":243560219,\"x\":0,\"y\":584,\"width\":392,\"height\":116,\"type\":\"shape\"},{\"id\":42106389,\"x\":0,\"y\":584,\"width\":192,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":221791530,\"x\":0,\"y\":604,\"width\":124,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":82895351,\"x\":0,\"y\":700,\"width\":392,\"height\":116,\"type\":\"shape\"},{\"id\":135915153,\"x\":0,\"y\":700,\"width\":192,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":208505334,\"x\":0,\"y\":720,\"width\":124,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}},{\"id\":139710855,\"x\":304,\"y\":693,\"width\":56,\"height\":56,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"shape\"},{\"id\":263601373,\"x\":0,\"y\":757,\"width\":392,\"height\":23,\"shapeStyle\":{\"backgroundColor\":\"#632CA6BF\",\"opacity\":191},\"type\":\"text\",\"text\":\"xxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#FFFFFFFF\"},\"textPosition\":{\"padding\":{\"top\":2,\"bottom\":2,\"left\":2,\"right\":2},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"top\"}}},{\"id\":133719008,\"x\":0,\"y\":30,\"width\":392,\"height\":56,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"shape\"}]}}]}\u0000\u0001\u0000\u0000\u0000\u0002{}\u0000\u0000\u0000\u0000\tZ{\"application_id\":\"f80e917c-3cd0-4048-ade7-1c4c207baa99\",\"session_id\":\"c3c2cfdf-2bf3-4a30-8368-767bc9310fb8\",\"view_id\":\"5ff4f0b2-0023-45b7-8307-11f09ce10fc6\",\"records\":[{\"timestamp\":1663834337326,\"type\":11,\"data\":{\"source\":0,\"adds\":[{\"previousId\":208505334,\"wireframe\":{\"id\":99104487,\"x\":0,\"y\":618,\"width\":392,\"height\":116,\"type\":\"shape\"}},{\"previousId\":99104487,\"wireframe\":{\"id\":57710081,\"x\":0,\"y\":618,\"width\":192,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}}},{\"previousId\":57710081,\"wireframe\":{\"id\":174742694,\"x\":0,\"y\":637,\"width\":124,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}}},{\"previousId\":174742694,\"wireframe\":{\"id\":158816899,\"x\":0,\"y\":734,\"width\":392,\"height\":116,\"type\":\"shape\"}},{\"previousId\":158816899,\"wireframe\":{\"id\":223318333,\"x\":0,\"y\":734,\"width\":192,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}}},{\"previousId\":223318333,\"wireframe\":{\"id\":189766962,\"x\":0,\"y\":753,\"width\":124,\"height\":19,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":0,\"bottom\":0,\"left\":8,\"right\":8},\"alignment\":{\"horizontal\":\"left\",\"vertical\":\"top\"}}}}],\"removes\":[{\"id\":224257807},{\"id\":110768105},{\"id\":24482926},{\"id\":194766123},{\"id\":31252901},{\"id\":40536442},{\"id\":165606177},{\"id\":243778374}],\"updates\":[{\"id\":191998215,\"y\":38,\"type\":\"shape\"},{\"id\":66440867,\"y\":154,\"type\":\"shape\"},{\"id\":160866397,\"y\":154,\"type\":\"text\"},{\"id\":250400210,\"y\":173,\"type\":\"text\"},{\"id\":218935807,\"y\":270,\"type\":\"shape\"},{\"id\":186770777,\"y\":270,\"type\":\"text\"},{\"id\":220591390,\"y\":289,\"type\":\"text\"},{\"id\":243560219,\"y\":386,\"type\":\"shape\"},{\"id\":42106389,\"y\":386,\"type\":\"text\"},{\"id\":221791530,\"y\":405,\"type\":\"text\"},{\"id\":82895351,\"y\":502,\"type\":\"shape\"},{\"id\":135915153,\"y\":502,\"type\":\"text\"},{\"id\":208505334,\"y\":521,\"type\":\"text\"}]}}]}\u0000\u0001\u0000\u0000\u0000\u0002{}\u0000\u0000\u0000\u0000\u0002�{\"application_id\":\"f80e917c-3cd0-4048-ade7-1c4c207baa99\",\"session_id\":\"c3c2cfdf-2bf3-4a30-8368-767bc9310fb8\",\"view_id\":\"5ff4f0b2-0023-45b7-8307-11f09ce10fc6\",\"records\":[{\"timestamp\":1663834337632,\"type\":11,\"data\":{\"source\":2,\"positions\":[{\"id\":0,\"x\":156,\"y\":410,\"timestamp\":1663834336999},{\"id\":0,\"x\":156,\"y\":412,\"timestamp\":1663834337019},{\"id\":0,\"x\":156,\"y\":407,\"timestamp\":1663834337084},{\"id\":0,\"x\":156,\"y\":360,\"timestamp\":1663834337119},{\"id\":0,\"x\":156,\"y\":293,\"timestamp\":1663834337152},{\"id\":0,\"x\":156,\"y\":242,\"timestamp\":1663834337186},{\"id\":0,\"x\":156,\"y\":213,\"timestamp\":1663834337219},{\"id\":0,\"x\":156,\"y\":198,\"timestamp\":1663834337252},{\"id\":0,\"x\":156,\"y\":193,\"timestamp\":1663834337286},{\"id\":0,\"x\":156,\"y\":193,\"timestamp\":1663834337632}]}}]}\u0000\u0001\u0000\u0000\u0000\u0002{}\u0000\u0000\u0000\u0000\u0003�{\"application_id\":\"f80e917c-3cd0-4048-ade7-1c4c207baa99\",\"session_id\":\"c3c2cfdf-2bf3-4a30-8368-767bc9310fb8\",\"view_id\":\"5ff4f0b2-0023-45b7-8307-11f09ce10fc6\",\"records\":[{\"timestamp\":1663834337727,\"type\":11,\"data\":{\"source\":0,\"adds\":[],\"removes\":[{\"id\":189766962}],\"updates\":[{\"id\":191998215,\"y\":41,\"type\":\"shape\"},{\"id\":66440867,\"y\":157,\"type\":\"shape\"},{\"id\":160866397,\"y\":157,\"type\":\"text\"},{\"id\":250400210,\"y\":177,\"type\":\"text\"},{\"id\":218935807,\"y\":273,\"type\":\"shape\"},{\"id\":186770777,\"y\":273,\"type\":\"text\"},{\"id\":220591390,\"y\":293,\"type\":\"text\"},{\"id\":243560219,\"y\":389,\"type\":\"shape\"},{\"id\":42106389,\"y\":389,\"type\":\"text\"},{\"id\":221791530,\"y\":409,\"type\":\"text\"},{\"id\":82895351,\"y\":505,\"type\":\"shape\"},{\"id\":135915153,\"y\":505,\"type\":\"text\"},{\"id\":208505334,\"y\":525,\"type\":\"text\"},{\"id\":99104487,\"y\":621,\"type\":\"shape\"},{\"id\":57710081,\"y\":621,\"type\":\"text\"},{\"id\":174742694,\"y\":641,\"type\":\"text\"},{\"id\":158816899,\"y\":737,\"type\":\"shape\"},{\"id\":223318333,\"y\":737,\"type\":\"text\"}]}}]}\u0000\u0001\u0000\u0000\u0000\u0002{}\u0000\u0000\u0000\u0000\u0000�{\"application_id\":\"f80e917c-3cd0-4048-ade7-1c4c207baa99\",\"session_id\":\"c3c2cfdf-2bf3-4a30-8368-767bc9310fb8\",\"view_id\":\"5ff4f0b2-0023-45b7-8307-11f09ce10fc6\",\"records\":[{\"timestamp\":1663834339387,\"type\":7}]}\u0000\u0001\u0000\u0000\u0000\u0002{}\u0000\u0000\u0000\u0000\u0014�{\"application_id\":\"f80e917c-3cd0-4048-ade7-1c4c207baa99\",\"session_id\":\"c3c2cfdf-2bf3-4a30-8368-767bc9310fb8\",\"view_id\":\"a8f930a6-0181-4228-a0d1-b753f795cace\",\"records\":[{\"timestamp\":1663834339387,\"type\":4,\"data\":{\"width\":392,\"height\":829}},{\"timestamp\":1663834339387,\"type\":6,\"data\":{\"has_focus\":true}},{\"timestamp\":1663834339387,\"type\":10,\"data\":{\"wireframes\":[{\"id\":265380693,\"x\":0,\"y\":0,\"width\":392,\"height\":829,\"shapeStyle\":{\"backgroundColor\":\"#FFFFFFFF\",\"opacity\":255},\"type\":\"shape\"},{\"id\":246406668,\"x\":0,\"y\":0,\"width\":392,\"height\":781,\"type\":\"shape\"},{\"id\":143773022,\"x\":0,\"y\":30,\"width\":392,\"height\":750,\"type\":\"shape\"},{\"id\":3044468,\"x\":0,\"y\":86,\"width\":392,\"height\":694,\"type\":\"shape\"},{\"id\":222818884,\"x\":0,\"y\":86,\"width\":392,\"height\":32,\"shapeStyle\":{\"backgroundColor\":\"#A538AFFF\",\"opacity\":255},\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":12,\"color\":\"#FFFFFFFF\"},\"textPosition\":{\"padding\":{\"top\":8,\"bottom\":8,\"left\":0,\"right\":0},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":64205282,\"x\":0,\"y\":118,\"width\":392,\"height\":703,\"type\":\"shape\"},{\"id\":242763134,\"x\":10,\"y\":128,\"width\":372,\"height\":58,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":20,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":16,\"bottom\":16,\"left\":16,\"right\":16},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"top\"}}},{\"id\":198585055,\"x\":18,\"y\":195,\"width\":356,\"height\":48,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"text\",\"text\":\"xxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":14,\"bottom\":14,\"left\":36,\"right\":12},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":45769516,\"x\":18,\"y\":251,\"width\":356,\"height\":48,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"text\",\"text\":\"xxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":14,\"bottom\":14,\"left\":36,\"right\":12},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":60543477,\"x\":18,\"y\":307,\"width\":356,\"height\":48,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"text\",\"text\":\"xxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":14,\"bottom\":14,\"left\":36,\"right\":12},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":198130570,\"x\":18,\"y\":363,\"width\":356,\"height\":56,\"type\":\"text\",\"text\":\"xxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":18,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":16,\"bottom\":16,\"left\":16,\"right\":16},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"top\"}}},{\"id\":35427835,\"x\":18,\"y\":427,\"width\":356,\"height\":48,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"text\",\"text\":\"xxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":14,\"bottom\":14,\"left\":36,\"right\":12},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":117474840,\"x\":18,\"y\":483,\"width\":356,\"height\":48,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"text\",\"text\":\"xxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":14,\"bottom\":14,\"left\":36,\"right\":12},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":44341361,\"x\":18,\"y\":539,\"width\":356,\"height\":48,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"text\",\"text\":\"xxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":14,\"bottom\":14,\"left\":36,\"right\":12},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":250447446,\"x\":18,\"y\":595,\"width\":356,\"height\":48,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"text\",\"text\":\"xxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":14,\"bottom\":14,\"left\":36,\"right\":12},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":110401239,\"x\":18,\"y\":651,\"width\":356,\"height\":48,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":14,\"bottom\":14,\"left\":36,\"right\":12},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":75754436,\"x\":18,\"y\":707,\"width\":356,\"height\":48,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":14,\"bottom\":14,\"left\":36,\"right\":12},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":194595501,\"x\":18,\"y\":763,\"width\":356,\"height\":48,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"text\",\"text\":\"xxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#000000FF\"},\"textPosition\":{\"padding\":{\"top\":14,\"bottom\":14,\"left\":36,\"right\":12},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"center\"}}},{\"id\":62259248,\"x\":0,\"y\":757,\"width\":392,\"height\":23,\"shapeStyle\":{\"backgroundColor\":\"#632CA6BF\",\"opacity\":191},\"type\":\"text\",\"text\":\"xxxxxxxxxxxxxx\",\"textStyle\":{\"family\":\"sans-serif\",\"size\":14,\"color\":\"#FFFFFFFF\"},\"textPosition\":{\"padding\":{\"top\":2,\"bottom\":2,\"left\":2,\"right\":2},\"alignment\":{\"horizontal\":\"center\",\"vertical\":\"top\"}}},{\"id\":133719008,\"x\":0,\"y\":30,\"width\":392,\"height\":56,\"border\":{\"color\":\"#000000FF\",\"width\":1},\"type\":\"shape\"}]}}]}"
    lateinit var testedBytesCompressor: BytesCompressor

    @BeforeEach
    fun `set up`(){
        testedBytesCompressor = BytesCompressor()
    }


    @Test
    fun test(forge: Forge){
//        val testString1 = forge.aString(10000)
//        val testString2 = forge.aString(10000)
////        testedBytesCompressor.compressBytes2(testString1.toByteArray())
////        testedBytesCompressor.compressBytes2(testString2.toByteArray())
//        val compressed1 = testedBytesCompressor.compressBytes(testString1.toByteArray())
//        val compressed2= testedBytesCompressor.compressBytes(testString2.toByteArray())
////        val compressed3=testedBytesCompressor.compressBytes(testString.toByteArray())
////        val compressed4= testedBytesCompressor.compressBytes(testString.toByteArray())
//
//        val inflater = Inflater(true)
////        val compressed = compressed1+compressed2
////        val compressed = compressed1.slice(0..compressed1.size-6)+
////                compressed2.slice(3..compressed1.size-6)+
////                compressed3.slice(3..compressed1.size-6)+
////                compressed4.slice(3..compressed1.size-6)
//        inflater.setInput(text3.toByteArray())
//        val output = ByteArray(testString1.toByteArray().size+testString2.toByteArray().size)
//        val length= inflater.inflate(output)
//        inflater.end()
//        val decompressedString = String(output,0,length)
//        assertThat(testString1+testString2).isEqualTo(decompressedString)
    }

    @Test
    fun test1(){
        val testString1 = "M"
        val testString2 = "A"
//        testedBytesCompressor.compressBytes2(testString1.toByteArray())
//        testedBytesCompressor.compressBytes2(testString2.toByteArray())
        val compressed1 = testedBytesCompressor.compressBytes3(testString1.toByteArray())
        val compressed2= testedBytesCompressor.compressBytes3(testString2.toByteArray())
//        val compressed3=testedBytesCompressor.compressBytes(testString.toByteArray())
//        val compressed4= testedBytesCompressor.compressBytes(testString.toByteArray())

        val inflater = Inflater()
        val compressed = compressed1.slice(0 until compressed1.size-6)+
                compressed2.slice(2 until compressed2.size-6)
//        val compressed = compressed1.slice(0..compressed1.size-6)+
//                compressed2.slice(3..compressed1.size-6)+
//                compressed3.slice(3..compressed1.size-6)+
//                compressed4.slice(3..compressed1.size-6)
        inflater.setInput(compressed.toByteArray())
        val output = ByteArray(testString1.toByteArray().size+testString2.toByteArray().size)
        val length= inflater.inflate(output)
        inflater.end()
        val decompressedString = String(output,0,length)
        assertThat(testString1+testString2).isEqualTo(decompressedString)
    }

    @Test
    fun test2(){
        val inputString = "blahblahblah"
        val input = inputString.toByteArray(charset("UTF-8"))

        // Compress the bytes

        // Compress the bytes
        val output = ByteArray(100)
        val compresser = Deflater()
        compresser.setInput(input)
        compresser.finish()
        compresser.deflate(output, 0, output.size,Deflater
                .SYNC_FLUSH)
        compresser.end()

        // Decompress the bytes

        // Decompress the bytes
        val decompresser = Inflater()
        decompresser.setInput(output)
        val result = ByteArray(100)
        val resultLength = decompresser.inflate(result)
        decompresser.end()

        // Decode the bytes into a String

        // Decode the bytes into a String
        val outputString = String(result, 0, resultLength, Charset.defaultCharset())
        assertThat(inputString).isEqualTo(outputString)

    }
}